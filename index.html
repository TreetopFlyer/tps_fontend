<!DOCTYPE html>
<html>
    <head>
        <script src="https://vuejs.org/js/vue.js"></script>
        <style>
            .Block
            {
                padding:1em;
                border:1px solid #aaa;
            }
        </style>
    </head>
    <body>
        <div id="App">
            <div v-for="(source, index) in API.Sources">
                <tps-source :object="source" :index="index" :list="API.Sources"/>
            </div>
        </div>
    </body>

    <!-- mixin crud -->
    <script>
    var MixinCRUD = {
        props:["object", "index", "list"],
        data:function()
        {
            return {
                clone:{}
            };
        },
        methods:{
            Clone:function()
            {
                this.clone = JSON.parse(JSON.stringify(this.object));
            },
            Create:function(inObject)
            {
                this.list.push(this.clone);
            },
            Duplicate:function()
            {
                this.list.splice(this.index, 0, JSON.parse(JSON.stringify(this.object)));
            },
            Update:function()
            {
                this.list.splice(this.index, 1, this.clone);
            },
            Delete:function()
            {
                this.list.splice(this.index, 1);
            }
        }
    }
    </script>

    <!-- editor-->
    <script>
    Vue.component("edit-editor", {
        props:{
            create:{default: false},
            edit:{default: false}
        },
        methods:{
            HandlerSubmit:function()
            {
                if(this.create)
                {
                    this.$emit('create');
                }
                if(this.edit)
                {
                    this.$emit('update');
                }
            }
        },
        template:"#TemplateBaseEditor"
    });
    </script>
    <script id="TemplateBaseEditor" type="text/x-template">
        <div>
            <form v-show="create || edit" v-on:submit.prevent="HandlerSubmit">
                <slot name="write"></slot>
                <div class="Controls" v-if="create">
                    <button v-on:click.prevent="$emit('create')"><i class="icon icon-plus-circle"></i> <span>Create</span></button>
                </div>
                <div class="Controls" v-else>
                    <button v-on:click.prevent="$emit('update')"><i class="icon icon-save"></i> <span>Update</span></button>
                    <button v-on:click.prevent="$emit('cancel')"><i class="icon icon-slash"></i> <span>Cancel</span></button>
                </div>
            </form>
            <div v-show="!create && !edit">
                <div class="Controls">
                    <button v-on:click.prevent="$emit('edit')"><i class="icon icon-edit"></i> <span>Edit</span></button>
                    <button v-on:click.prevent="$emit('duplicate')"><i class="icon icon-copy"></i> <span>Duplicate</span></button>
                    <button v-on:click.prevent="$emit('delete')"><i class="icon icon-trash-2"></i> <span>Delete</span></button>
                </div>
                <slot name="read"></slot>
            </div>
        </div>
    </script>

    <!-- component tps-source -->
    <script>
    Vue.component("tps-source", {
        mixins:[MixinCRUD],
        template:"#template-tps-source",
    });
    </script>
    <script type="text/x-template" id="template-tps-source">
        <div class="Block Source">
            <strong>{{index}}</strong>
            <div>
                {{object.name}} | {{object.data}}
            </div>
            <button v-on:click="Create">create new</button>
            <button v-on:click="Delete">delete</button>
            <button v-on:click="Duplicate">duplicate</button>
            <button v-on:click="Update">update</button>
            <div>
                <tps-child v-for="(childObject, childIndex) in object.children" :object="childObject" :index="childIndex" :list="object.children"></tps-child>
            </div>
        </div>
    </script>

    <!-- component child -->
    <script>
    Vue.component("tps-child", {
        mixins:[MixinCRUD],
        template:"#template-tps-child",
    });
    </script>
    <script type="text/x-template" id="template-tps-child">
        <div class="Block Child">
            <strong>{{index}}</strong>
            <div>
                {{object.name}} | {{object.type}} | {{object.active}}
            </div>
            <button v-on:click="Create">create new</button>
            <button v-on:click="Delete">delete</button>
            <button v-on:click="Duplicate">duplicate</button>
            <button v-on:click="Update">update</button>
        </div>
    </script>

    <!-- application -->
    <script>
        var App = new Vue({
            el:"#App",
            data:{
                API:{
                    Domain:'//localhost:80',
                    RequestLog:[],
                    Sources:[
                        {
                            name:"gjgpjegpseg",
                            data: 54,
                            children:[
                                {
                                    name:"apgiespgse",
                                    type:"json",
                                    active:false
                                }
                            ]
                        }
                    ]
                }
            }
        });
    </script>
</html>