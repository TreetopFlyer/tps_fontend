<!DOCTYPE html>
<html>
    <head>
        <script src="https://vuejs.org/js/vue.js"></script>
        <style>
            .Editor
            {
                padding:1em;
                border:1px solid #aaa;
            }
        </style>
    </head>
    <body>
        <div id="App">
            <type-editor :default-settings="{name:'default', data:7}" :list="API.Sources"></type-editor>
        </div>
    </body>

    <!-- mixin CRUD -->
    <script>
    var MixinCRUD = {
        props:["object", "index", "list"],
        data:function()
        {
            return {
                clone:{}
            };
        },
        methods:{
            Clone:function()
            {
                this.clone = JSON.parse(JSON.stringify(this.object));
            },
            Create:function()
            {
                this.list.push(JSON.parse(JSON.stringify(this.clone)));
            },
            Duplicate:function()
            {
                this.list.splice(this.index, 0, JSON.parse(JSON.stringify(this.object)));
            },
            Update:function()
            {
                this.list.splice(this.index, 1, this.clone);
            },
            Delete:function()
            {
                this.list.splice(this.index, 1);
            }
        }
    }
    </script>

    <!-- editor-->
    <script>
    Vue.component("editor", {
        mixins:[MixinCRUD],
        props:{
            create:{default: false}
        },
        data:function()
        {
            return {
                edit:false
            }
        },
        methods:{
            EditStart:function()
            {
                this.Clone();
                this.edit = true;
            },
            EditCancel:function()
            {
                this.edit = false;
            },
            EditSave:function()
            {
                this.Update();
                this.edit = false;
            }
        },
        mounted:function()
        {
            console.log("editor mounted");
            this.Clone();
        },
        template:"#TemplateBaseEditor"
    });
    </script>
    <script id="TemplateBaseEditor" type="text/x-template">
        <div class="Editor">
            <form v-if="create" v-on:submit.prevent="Create">
                <slot name="write" :object="clone">
                </slot>
                <div class="Controls">
                    <button v-on:click.prevent="Create">    <i class="icon icon-plus-circle"></i> <span>Create</span></button>
                </div>
            </form>
            <form v-if="edit" v-on:submit.prevent="Update">
                <slot name="write" :object="clone">
                </slot>
                <div class="Controls">
                    <button v-on:click.prevent="EditSave">  <i class="icon icon-save"></i>       <span>Update</span></button>
                    <button v-on:click.prevent="EditCancel"><i class="icon icon-slash"></i>      <span>Cancel</span></button>
                </div>
            </form>
            <div v-if="!create && !edit">
                <div class="Controls">
                    <button v-on:click.prevent="EditStart"><i class="icon icon-edit"></i>        <span>Edit</span></button>
                    <button v-on:click.prevent="Duplicate"><i class="icon icon-copy"></i>        <span>Duplicate</span></button>
                    <button v-on:click.prevent="Delete">   <i class="icon icon-trash-2"></i>     <span>Delete</span></button>
                </div>
                <slot name="read" :object="object"></slot>
            </div>
        </div>
    </script>

    <!-- editor array -->
    <script>
        Vue.component("type-editor", {
            props:["defaultSettings", "list", "dataType"],
            template:"#TemplateTypeEditor"
        });
    </script>
    <script id="TemplateTypeEditor" type="text/x-template">
        <div>
            <editor create="true" :object="defaultSettings" :list="list">
                <template slot="write" slot-scope="context">
                    <input type="text" v-model="context.object.name"/>
                </template>
            </editor>
            <hr>
            <editor v-for="(object, index) in list" :object="object" :index="index" :list="list">
                <template slot="read" slot-scope="context">
                    <h3>hey: {{context.object.name}}</h3>
                </template>
                <template slot="write" slot-scope="context">
                    <input type="text" v-model="context.object.name"/>
                </template>
            </editor>
        </div>
    </script>

    <!-- mixin DataType-->
    <script>
    var MixinDataType = {
        props:["read", "write", "object"]
    }
    </script>
    <!-- Data Type: Source -->
    <script>
    Vue.component("source", {
        mixins:[MixinDataType],
        template:"#TemplateDataTypeSource"
    });
    </script>
    <script id="TemplateDataTypeSource" type="text/x-template">
        <div>
            <div v-if="read">
                <h3>{{object.name}} | {{object.data}}</h3>
            </div>
            <div v-if="write">
                <input type="text" v-model="object.name"/>
                <input type="number" v-model="object.data"/>
            </div>
        </div>
    </script>
    
    <!-- application -->
    <script>
        var App = new Vue({
            el:"#App",
            data:{
                API:{
                    Domain:'//localhost:80',
                    RequestLog:[],
                    Sources:[
                        {
                            name:"gjgpjegpseg",
                            data: 54,
                            children:[
                                {
                                    name:"apgiespgse",
                                    type:"json",
                                    active:false
                                }
                            ]
                        }
                    ]
                }
            }
        });
    </script>
</html>