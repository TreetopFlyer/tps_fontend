<!DOCTYPE html>
<html>
    <head>
        <script src="https://vuejs.org/js/vue.js"></script>
        <script>
            var Model = {
                client:"seth",
                sources:[
                    {
                        name:"Source1",
                        type:"xml",
                        layouts:[
                            {
                                name:"Layout1",
                                columns:[
                                    {
                                        name:"Col1",
                                        type:"text"
                                    },
                                    {
                                        name:"Col2",
                                        type:"date"
                                    }
                                ]
                            }
                        ]
                    }
                ]
            };
            var Schema = {
                Root:{
                    client:{type:"string"},
                    sources:{type:"array", settings:"Source"}
                },
                Source:{
                    name:{type:"string", default:"new source", display:"Source"},
                    type:{type:"enum", default:"xml", display:"Type", settings:["xml", "json", "csv"]},
                    layouts:{type:"array", settings:"Layout"}
                },
                Layout:{
                    name:{type:"string", default:"new layout", display:"Layout"},
                    columns:{type:"array", settings:"Column"}
                },
                Column:{
                    name:{type:"string", default:"new column", display:"Column"},
                    type:{type:"enum", default:"text", display:"Type", settings:["text", "date", "number", "boolean"]}
                }
            };
            function Merge(inModel, inSchema, inPattern)
            {
                var i;
                var output, property;
                var pattern;
                var patternKey, patternValue, modelValue;
            
                pattern = inSchema[inPattern];
                output = {
                    Leaves:[],
                    Branches:[]
                };
                for(patternKey in pattern)
                {
                    patternValue = pattern[patternKey];
                    modelValue = inModel[patternKey];
            
                    property = {
                        Key:patternKey,
                        Value:modelValue,
                        Annotation:patternValue
                    };
            
                    if(patternValue.type === "array")
                    {
                        var replacement = [];
                        //replace the array of objects inValue with an array of merged objects
                        for(i=0; i<modelValue.length; i++)
                        {
                            replacement.push( Merge(modelValue[i], inSchema, patternValue.settings) );
                        }
                        property.Value = replacement;
                        output.Branches.push(property);
                    }
                    else
                    {
                        output.Leaves.push(property);
                    }
                }
                return output;
            }
            function Split(inMerge)
            {
                var i;
                var item;
                var obj;
                var array;
                obj = {};
                for(i=0; i<inMerge.Leaves.length; i++)
                {
                    item = inMerge.Leaves[i];
                    obj[item.Key] = item.Value;
                }
                for(i=0; i<inMerge.Branches.length; i++)
                {
                    array = [];
                    item = inMerge.Branches[i];
                    for(j=0; j<item.Value.length; j++)
                    {
                        array.push( Split(item.Value[j]) );
                    }
                    obj[item.Key] = array;
                }
                return obj;
            }
            var merge = Merge(Model, Schema, "Root");
            var split = Split(merge);
            console.log(merge, split);
        </script>
    </head>
    <body>
        <div id="App">
        </div>
    </body>
</html>